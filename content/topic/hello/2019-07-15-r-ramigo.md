---
title: RamiGO 安装及库依赖解决备忘
type: post
tags: ["R", "工具"]
date: 2019-07-15T09:24:35.000Z
category: 工具
published: true
---


## 一、RamiGO 安装

```bash
$ /Bioinfo/Pipeline/SoftWare/R/R-3.6.1/bin/R CMD INSTALL /Bioinfo/Pipeline/SourceCode/pkgs/RamiGO_1.20.0.tar.gz
* installing to library ‘/Bioinfo/Pipeline/SoftWare/R/R-3.6.1/lib64/R/library’
ERROR: dependencies ‘gsubfn’, ‘igraph’, ‘RCurl’, ‘png’, ‘RCytoscape’, ‘graph’ are not available for package ‘RamiGO’
* removing ‘/Bioinfo/Pipeline/SoftWare/R/R-3.6.1/lib64/R/library/RamiGO’

# 安装 gsubfn, igraph, RCurl
install.packages(c("igraph", "igraph", "RCurl", "png"))

# 安装 graph
BiocManager::install("graph")

$ /Bioinfo/Pipeline/SoftWare/R/R-3.6.1/bin/R CMD INSTALL /Bioinfo/Pipeline/SourceCode/pkgs/RCytoscape_1.12.0.tar.gz
* installing to library ‘/Bioinfo/Pipeline/SoftWare/R/R-3.6.1/lib64/R/library’
ERROR: dependency ‘XMLRPC’ is not available for package ‘RCytoscape’
* removing ‘/Bioinfo/Pipeline/SoftWare/R/R-3.6.1/lib64/R/library/RCytoscape’

install.packages("devtools")
install_github("duncantl/XMLRPC")

$ /Bioinfo/Pipeline/SoftWare/R/R-3.6.1/bin/R CMD INSTALL /Bioinfo/Pipeline/SourceCode/pkgs/RamiGO_1.20.0.tar.gz
* installing to library ‘/Bioinfo/Pipeline/SoftWare/R/R-3.6.1/lib64/R/library’
* installing *source* package ‘RamiGO’ ...
** using staged installation
** R
** data
** inst
** byte-compile and prepare package for lazy loading
Error in dyn.load(file, DLLpath = DLLpath, ...) :
  unable to load shared object '/Bioinfo/Pipeline/SoftWare/R/R-3.6.1/lib64/R/library/png/libs/png.so':
  libpng16.so.16: cannot open shared object file: No such file or directory
Calls: <Anonymous> ... asNamespace -> loadNamespace -> library.dynam -> dyn.load
Execution halted
ERROR: lazy loading failed for package ‘RamiGO’
* removing ‘/Bioinfo/Pipeline/SoftWare/R/R-3.6.1/lib64/R/library/RamiGO’


$ export LD_LIBRARY_PATH=/Bioinfo/Pipeline/SoftWare/LibDependence/libpng-1.6.37/
bin/     include/ lib/     share/

$ export LD_LIBRARY_PATH=/Bioinfo/Pipeline/SoftWare/LibDependence/libpng-1.6.37/lib:$LD_LIBRARY_PATH

$ /Bioinfo/Pipeline/SoftWare/R/R-3.6.1/bin/R CMD INSTALL /Bioinfo/Pipeline/SourceCode/pkgs/RamiGO_1.20.0.tar.gz
* installing to library ‘/Bioinfo/Pipeline/SoftWare/R/R-3.6.1/lib64/R/library’
* installing *source* package ‘RamiGO’ ...
** using staged installation
** R
** data
** inst
** byte-compile and prepare package for lazy loading
** help
*** installing help indices
** building package indices
** installing vignettes
** testing if installed package can be loaded from temporary location
** testing if installed package can be loaded from final location
** testing if installed package keeps a record of temporary installation path
* DONE (RamiGO)
```



## 二、RamiGO 使用与 libpng 依赖库异常

使用 `RamiGO` R 包过程中，如果发现：
```r
> library('RamiGO')
Loading required package: gsubfn
Loading required package: proto
> goIDs <- c("GO:0051130","GO:0019912","GO:0005783","GO:0043229","GO:0050789")
> color <- c("lightblue","red","yellow","green","pink")
> getAmigoTree(goIDs=goIDs, color=color, filename="example", picType="png",saveResult = TRUE)
Error in  :
  libpng error: Incompatible libpng version in application and library
In addition: Warning messages:
1: In  :
  libpng warning: Application was compiled with png.h from libpng-1.6.37
2: In  :
  libpng warning: Application  is  running with png.c from libpng-1.2.49

```

首先，如果是源码编译安装的 R（参考：《[手把手教你如何在 Linux 源码安装最新版本的 R](https://www.yuque.com/shenweiyan/bioinit/install-r-from-source)》），可以尝试在 configure 的时候把 libpng 相关的的 LDFLAGS 和 CPPFLAGS 去掉，重新安装 R。

然后，通过拷贝缺失的共享库解决存在的问题。
```r
> libr
Loading required package: gsubfn
Loading required package: proto
Error: package or namespace load failed for ‘RamiGO’ in dyn.load(file, DLLpath = DLLpath, ...):
 unable to load shared object '/Bioinfo/Pipeline/SoftWare/R/R-3.6.1/lib64/R/library/png/libs/png.so':
  libpng16.so.16: cannot open shared object file: No such file or directory
> goIDs <- c("GO:0051130","GO:0019912","GO:0005783","GO:0043229","GO:0050789")
> color <- c("lightblue","red","yellow","green","pink")
> getAmigoTree(goIDs=goIDs, color=color, filename="example", picType="png",saveResult = TRUE)
Error in getAmigoTree(goIDs = goIDs, color = color, filename = "example",  :
  could not find function "getAmigoTree"

```

```shell
$ ldd /Bioinfo/Pipeline/SoftWare/R/R-3.6.1/lib64/R/library/png/libs/png.so
        linux-vdso.so.1 =>  (0x00007f
        libpng16.so.16 => not found
        libm.so.6 => /lib64/libm.so.6 (0x00007f
        libz.so.1 => /RiboBio/Bioinfo/APPS/R-3.3.2/lib/libz.so.1 (0x00007f
        libR.so => not found
        libc.so.6 => /lib64/libc.so.6 (0x00007f
        /lib64/ld-linux-x86-64.so.2 (0x000000

$ ln -s /Bioinfo/Pipeline/SoftWare/LibDependence/libpng-1.6.37/lib/libpng16.so.16.37.0 /usr/lib64/libpng16.so.16
$ ln -s /Bioinfo/Pipeline/SoftWare/R/R-3.6.1/lib64/R/lib/libR.so /usr/lib64/libR.so

$ ldd /Bioinfo/Pipeline/SoftWare/R/R-3.6.1/lib64/R/library/png/libs/png.so
        linux-vdso.so.1 =>  (0x00007f
        libpng16.so.16 (0x00007f
        libm.so.6 => /lib64/libm.so.6 (0x00007f
        libz.so.1 => /Bioinfo/APPS/R-3.3.2/lib/libz.so.1 (0x00007f
        libR.so => /usr/lib64/libR.so (0x00007f
        libc.so.6 => /lib64/libc.so.6 (0x00007f
        libRblas.so => not found
        libgfortran.so.3 => /usr/lib64/libgfortran.so.3 (0x00007f
        libreadline.so.6 => /lib64/libreadline.so.6 (0x00007f
        libpcre.so.1 => /Bioinfo/APPS/R-3.3.2/lib/libpcre.so.1 (0x00007f
        liblzma.so.5 => /Bioinfo/APPS/R-3.3.2/lib/liblzma.so.5 (0x00007f
        librt.so.1 => /lib64/librt.so.1 (0x00007f
        libdl.so.2 => /lib64/libdl.so.2 (0x00007f
        libiconv.so.2 => /usr/local/lib/libiconv.so.2 (0x00007f
        libgomp.so.1 => /Bioinfo/APPS/gcc-5.1.0/lib64/libgomp.so.1 (0x00007f
        libpthread.so.0 => /lib64/libpthread.so.0 (0x00007f
        /lib64/ld-linux-x86-64.so.2 (0x000000
        libtinfo.so.5 => /lib64/libtinfo.so.5 (0x00007f

$ ln -s /Bioinfo/Pipeline/SoftWare/R/R-3.6.1/lib64/R/lib/libRblas.so /usr/lib64/libRblas.so

$ ldd /Bioinfo/Pipeline/SoftWare/R/R-3.6.1/lib64/R/library/png/libs/png.so
        linux-vdso.so.1 =>  (0x00007f
        libpng16.so.16 (0x00007f
        libm.so.6 => /lib64/libm.so.6 (0x00007f
        libz.so.1 => /Bioinfo/APPS/R-3.3.2/lib/libz.so.1 (0x00007f
        libR.so => /usr/lib64/libR.so (0x00007f
        libc.so.6 => /lib64/libc.so.6 (0x00007f
        libRblas.so => /usr/lib64/libRblas.so (0x00007f
        libgfortran.so.3 => /usr/lib64/libgfortran.so.3 (0x00007f
        libreadline.so.6 => /lib64/libreadline.so.6 (0x00007f
        libpcre.so.1 => /Bioinfo/APPS/R-3.3.2/lib/libpcre.so.1 (0x00007f
        liblzma.so.5 => /Bioinfo/APPS/R-3.3.2/lib/liblzma.so.5 (0x00007f
        librt.so.1 => /lib64/librt.so.1 (0x00007f
        libdl.so.2 => /lib64/libdl.so.2 (0x00007f
        libiconv.so.2 => /usr/local/lib/libiconv.so.2 (0x00007f
        libgomp.so.1 => /Bioinfo/APPS/gcc-5.1.0/lib64/libgomp.so.1 (0x00007f
        libpthread.so.0 => /lib64/libpthread.so.0 (0x00007f
        /lib64/ld-linux-x86-64.so.2 (0x000000
        libtinfo.so.5 => /lib64/libtinfo.so.5 (0x00007f
```

最后，RamiGO 包可以正常使用：<br />![image.png](https://qiniu.bioinit.com/yuque/0/2019/png/126032/1563240595278-ec34a2ee-8308-4a01-9009-5b1eec1e712d.png#align=left&display=inline&height=482&name=image.png&originHeight=482&originWidth=948&size=49598&status=done&width=948)
